# Getting Started

This is an email api fully built with `TypeScript` and `Node`, it keeps track of imaginary inboxes and the emails that get sent between them.

To install and run locally, clone the repo then:

    $ npm run dev


### ERD

See the Entity Relation Diagram [here](https://viewer.diagrams.net/?tags=%7B%7D&edit=_blank&layers=1&nav=1&title=new%20erd#R7V1dc9o4FP01PLaDbWzI40KSbrakm03SbfZpR4kVcNdYVBYF%2ButXsi2%2BFAWc4A98NZOZYCErRvfoHO65it1yBpPFJ4qm42vi47Blt%2F1Fyzlv2bbVti3%2BS7Qs05ZO104bRjTws07rhrvgF5ZnZq2zwMfxVkdGSMiC6XbjE4ki%2FMS22hClZL7d7ZmE2391ikZYabh7QqHa%2Bi3w2Tht7dnddfvvOBiN5V%2B2vLP0nQmSnbNPEo%2BRT%2BYbTc5FyxlQQlj6arIY4FBMnpyXb1fLb%2BHwP%2B%2FTH3%2FFP9DX%2Fuf7L39%2FSAe7zHPK6iNQHLE3D%2F3jjg2sz8PFv8%2F058PAJXc3dJ6d0v6Jwlk2X19jTLPPy5ZyEvlHn4qXDD2Kpn7MEGVZrJ02b%2BDRYyiI%2BKnOuZUchyGaxkHSPW0ZB6E%2FREsyY3IgedR%2FDhbYv01DLfryqA%2F5YOJQDP7MB7%2FLLka8jcJgFPHXT3w6xF%2FsUxzzaxmimGU9sk%2BFKcOLHRjsmUNrFVi%2BIjCZYEaX%2FLxsFC%2Bbr2wtOBIa8zWyrF7WNt5ElWxEGZpHq6HXEeMvsqDlCKClBPD14N0KBPfHhAa%2FRMjCbIo3A5ocz4NJiCK%2BNJC%2F09QnCRUkgQnCcEBCIqIekQgrgRedfEqm94iOMMsapiSIWDIPbp%2F%2F8JkZtD%2B6LZdf64AfW%2Btj%2FiO6UzYgUcwoB5gYA%2FM4z7GIdZ%2BRaTZoiJ%2Fl%2BDSbd%2FH6kTBGJnlQoV8mKiokDA5EgVMUCGwFBDeftTDgH5YFKLzlZIuiUZgGLeFetA7aC5F9ca5X87s78btrlvBpfw4T%2BhwHvo%2Bjd8VDs0o3AuDknP9ssPWs5B4NhZyMIsT4AplFfqwEdXWdb4%2Bzo8T56rziOEsuTvv24yl6CqLRMD3T2wGCWxYQFvqF6R4VGAcNVwIyOkYGDpKBdoEy4FUtA64CgsuqZQD7gRxPpwLbSvHm2HRgSoL34hf4%2BstC%2BUgApwldowmVa8JZ1ZrQOxwEtVGEtwejC1MEzpQgf0ETfIoScPTQg2N96bsa2q%2BQ9q1DjcHCeN%2FKYQw2gPgtTTyazvyWav1dTFAQwuJ%2BXfThkb%2FqEBryL5383crJP4cd2ATyd4CSv2r43aA4nhPqA%2BN%2FDQDg8b9qB15Fj2Txugi04Bb0HRkkyd2Hmvirb%2FjHJ2%2Fj25VR0k%2BXSn1r%2Bpbq3DW9qA%2FUvbNU%2B67%2B9ZuCy%2FrGzct29hg3r4yEbo8YVF7Zt1U3D1Bpf2O3LShhkGvdFPf3YwGeMhirrwbKUHl934Zl9dlArT5btfoA1nl00YdH%2FmrKeE9RPH5dAYzPt7Z3qvf55BUZAS%2FU50uXSn19PkdN7Rru8zlA0znnhXQuCn7McP0TumLdPh0gwMm6Y3K6MnK6PZJQudvnqDkdILfPAZriOWqKB97t02EBnjKoGzuMMpSuDJW7fU6OvSG10YV3LH%2BN%2Bdp4KVD3fiRuX3yKUnD88INj%2F46aOQ7RI34FD8bv2%2Fb73IP9Prco7u6Y5K4Mvy9dK%2FX1%2Bzpqctdwv68DNKHrqAld%2FZO5Yp0%2BHRTgKbrJ58rI5%2FaIQeVOX0fN5wA5fR2g6V1HTe%2FAO306LMBTBnVrh1GG0pWhcqdPohGI09fRGK9NlwJX3f0B79Y9uuCD435X9fkM95fO%2FdXfvMfNYRU2gPxdTTwaT%2F6qFQixzKMLPzz612zyN2UeHTa89s627kOp2%2B4Wxt3G2SujzJOulfqWeVzV2Wt4mccF6ua5qptXfyev2DKPDgrwFN2YeWUkdHvEoPIyj7wAmGUeF6i356neHvgyjw4L4JTBM1ZfDZSh8jKPB8vp84A6fZ7q9N3NHr%2BL552eoBYcP%2F7w6F%2B1%2Bgz9l07%2F1Vd6vBxuYRP4XxOPxvO%2F6gZe4zgWj66Gxf%2Ba%2BMPj%2FxzP5TL8Xxj%2FV%2F6kBi%2BHQdgE%2Fu%2FB5H9ZbdwIM7%2FgYBpgsaJgSYAGAuAkoJvjCV1GAgqTgF7VEtDN4QQ2QAK6mh0djZcA1em7pHz6QZG%2FLvjwyD%2FHbXsN%2BRdF%2FrZVOfnn8AGbQP6aZ7M3nvxVmy%2B5gQcw9tdEHx77m0d81YH9O5Wzfw4XsAnsD%2FQBX90X7tYeTPhaQJMpMAUwz%2FVKJ0LSzEbgsT%2FCcocVJ88xGZEIhRfr1j4Vl4Mls6%2F7DEkSc7Fgv2PGlpkioBkjQjXYJMzexYuAPWy8%2FkcM9dHNjs4XkgTEgVQLHlC6fNg8SM9yHEc2rE9MjrbOvMGUQz35t5Cs0f%2BN0gRPF7cTFPl%2FJqjlzZdBuKVrL3VL3tjomE6imDktDvX%2FVcJnn8zoE34lTFmWxqQQ6vrpnkpEcYhY8HP76o4uIz3r1MFked23gOlgnByEuqLB1D0QTLqb3pYEJvUryImByd0Dpbeh5hem5J5co2hZOnCkS7EXObqbqJSEHOdUkLODgK3Q1hUE9qEg0G2xLgkEvVMBwYo%2BPrQ%2FttvONof0POsIgnQSwJIPndgLLN3mzZKAdXZywHqfLqWQqLcyydsY7sWOzvp7L3ZaoohG2GZyRtF0fE18LHr8Dw%3D%3D)


### Authentication

All routes in under this api require full authentication, before making any
request ensure that you create an account then sign in

* http://localhost:5000/signin or
* https://prj-email-api.herokuapp.com/signin

## ENDPOINTS

Base url `http://localhost:5000/` or `https://prj-email-api.herokuapp.com/` 
<br>

The mail routes are designed as presented

|ROUTE|METHOD|
| --- | --- | 
| /signup| POST | 
| /signin| POST | 
| /signout | POST | 


<br>

The mail routes are designed as presented

|ROUTE|METHOD|FUNCTION|
| --- | --- | --- |
| /mail/send | POST | Sends email |
| /mail/get | GET | Gets user emails |
| /mail/delete/:id | DELETE | Deletes email `WHERE id == req.params.id` |
| /mail/trash | GET | Gets user deleted emails |
| /mail/trash/recover/:id | PUT | Recovers email from trash `WHERE id == req.params.id` |

<br>

The labels routes are designed as presented

|ROUTE|METHOD|FUNCTION|
| --- | --- | --- |
| /labels/create | POST | Creates a label |
| /labels/delete/:name | DELETE | Deletes a label `WHERE name == req.params.name` && `user.id == req.user.id` |
| /labels/:name/attach/:EId | PUT | Finds email `WHERE email.id == req.params.EId` and attaches label `req.params.name` to it |
| /labels/:name/remove/:EId | DELETE | Removes `req.params.name` label `WHERE email.id == req.params.EId` |
| /labels/:name | GET | Returns all emails under the `req.params.name` label |

<br>

## REQUEST DATA, BODY AND PARAMS

To create and provide the most reliable data, the api depends on `Passport JS` and `Bcrypt`.
Each authenticated request provides information about the user and this is made possible through the Passport middleware.
<br>

To ensure the authenticity of each request, the api depends on the result of `req.isAuthenticated()`. 
If the result confirms that request is authenticated, the identity of the user requesting such data is 
then pulled from the session data through `req.user`. 
This allows us to trust and therefore procees and send through protected data to the authorised user.

<br>

# API REFERENCE

## REQUEST
Create an account
<br>

POST `/signup` <br>
HTTP/1.1 <br>
Content-Type: application/json


```js
{
    name: "william"
    email: "william@gmail.com",
    password: "123"
}
```

<br>

## REQUEST
Log into your account
<br>

POST `/signin` <br>
HTTP/1.1 <br>
Content-Type: application/json


```js
{
    email: "william@gmail.com",
    password: "123"
}
```

<br>

## REQUEST
Log out of your account
<br>

POST `/signout` <br>
HTTP/1.1 <br>
Content-Type: application/json

<br>

## REQUEST 
Get all emails in your inbox

<br>

GET `/mail/get` <br>
HTTP/1.1 <br>
Content-Type: application/json

<br>


## REQUEST
Send an email
<br>

POST `/mail/send` <br>
HTTP/1.1 <br>
Content-Type: application/json


```js
{
    subject: "Reminder"
    message: "You're doing great!",
    recipients: ["self@gmail.com", "you@gmail.com"]
}
```

<br>

## REQUEST
Delete an email
<br>


DELETE `/mail/delete/{id}` <br>
HTTP/1.1 <br>
Content-Type: application/json

<br>

## REQUEST
Get all deleted emails
<br>


GET `/mail/trash` <br>
HTTP/1.1 <br>
Content-Type: application/json

<br>


## REQUEST
Recover an email
<br>


PUT `/mail/trash/recover/{id}` <br>
HTTP/1.1 <br>
Content-Type: application/json

<br>

## REQUEST
Create a label
<br>


POST `/labels/create` <br>
HTTP/1.1 <br>
Content-Type: application/json

```js
{
    name: "important"
}
```
<br>

## REQUEST
Delete a label
<br>


DELETE `/labels/delete/{name}` <br>
HTTP/1.1 <br>
Content-Type: application/json


<br>

## REQUEST
Attach a label to email
<br>


PUT `/labels/{name}/attach/{EId}` <br>
HTTP/1.1 <br>
Content-Type: application/json


<br>

## REQUEST
Remove label from email
<br>


DELETE `/labels/{name}/remove/{EId}` <br>
HTTP/1.1 <br>
Content-Type: application/json


<br>

## REQUEST
Get all emails with label
<br>


GET `/labels/{name}` <br>
HTTP/1.1 <br>
Content-Type: application/json


<br>


